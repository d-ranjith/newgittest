Solution Design Document: ATX Withholding Tax Microservice
1. üìå Executive Summary
OrgA must respond to regulatory changes introduced by the U.S. Government requiring new withholding tax calculations across different jurisdictions and products. The current Java-based monolith (ATX) is hard to maintain and scale. This design proposes a microservices-based approach beginning with a focused POC that isolates the withholding tax computation logic and decouples the UI layer. This serves as a foundation for full modernization and future cloud migration.

2. üéØ Goal Statement (One-liner)
"Modernize and modularize the ATX tax engine to enable faster compliance updates, improved maintainability, and readiness for cloud deployment."

3. üìà Business Motivation (Situation, Outcome, Metrics, Benefits, Solution)
Category	Description
Situation (Drives)	New U.S. withholding tax rules require rapid implementation; existing monolith (ATX) is too complex and slow to adapt
Outcome (Guides)	Build a tax computation microservice and decouple UI to prove the microservices approach
Metrics (Measured by)	Time to deliver changes, regression issues, build/deployment frequency, time to test
Benefits (Created)	Faster tax rule updates, easier testing, modular deployments, reduced risk of knock-on issues
Solution (Enablers)	Microservice architecture, Spring Boot, REST APIs, containerization, secure rate update endpoint, cloud-native design principles

4. üß† High-Level Architecture
pgsql
Copy
Edit
+----------------------+        +---------------------------+       +----------------------------+
|     Web Frontend     | <-->   |  API Gateway (Optional)   | <-->  |  Tax Computation Service   |
| (Thymeleaf React UI) |        | (Authentication, Routing) |       |  - Withholding Rules       |
+----------------------+        +---------------------------+       |  - EU Country Mapping      |
                                                                     |  - Admin Rate Update API   |
                                                                     +----------------------------+

                    +------------------------+
                    | Reference Data Storage |
                    | - ISO Country Rates    |
                    | - EU Country Codes     |
                    +------------------------+
5. üß© Components and Responsibilities
Component	Description
Frontend UI	Thymeleaf-based or React frontend; collects input (ISO code, USD income) and displays results
API Gateway (Optional)	Handles rate limiting, auth, routing
Tax Computation Service	Stateless Spring Boot microservice with /compute endpoint
Rate Admin API	Secured endpoint to modify tax rates dynamically
Data Store (Optional in POC)	JSON file, H2, or Redis for country rates and EU country mappings

6. ‚öôÔ∏è Key Endpoints
6.1. /compute
http
Copy
Edit
POST /api/tax/compute
{
  "isoCountryCode": "AT",
  "incomeUsd": 10000.0
}
Logic:

Map EU country codes to "EU"

Look up rate (default 30% if not found)

Compute: withholding = rate * income

Output:

json
Copy
Edit
{
  "withholdingTaxAmount": 1500.0,
  "appliedRate": 0.15
}
6.2. /admin/rate (future or Day 3 optional)
http
Copy
Edit
POST /api/admin/rate
{
  "isoCountryCode": "AU",
  "rate": 0.12
}
7. ‚òÅÔ∏è Cloud & DevOps Considerations
Area	Practice
Containerization	Dockerfile with Spring Boot app
CI/CD	GitHub Actions or Tekton pipeline
Secrets	Store DB/API keys in K8s secrets or AWS Secrets Manager
Deployment	Use Helm charts or K8s manifests
Monitoring	Spring Boot Actuator + Prometheus
Security	JWT or OAuth2 for admin endpoints
Rate Update Audit	Store changes with timestamps and user IDs (future phase)

8. üß™ Testing Approach
Test Type	Description
Unit Tests	Tax calculation logic, ISO mapping
Integration Tests	REST endpoint verification
Contract Tests	OpenAPI definition match
Security Tests	Rate update auth check
Mock Tests	Mocked country rate data service

9. üöÄ Implementation Plan: 3-Day POC
Day	Activity
Day 1	Understand code logic, isolate /post logic from monolith, scaffold new microservice (Spring Boot), create EU country mapping, test calculation logic
Day 2	Build frontend UI (Thymeleaf or React), expose /compute endpoint, containerize app, prepare presentation deck
Day 3	(Optional) Implement /admin/rate, CI pipeline, prepare Helm chart or Docker Compose, stakeholder presentation

10. üìä Design Decisions
Area	Decision
Service Granularity	Single microservice for tax computation now; may split country lookup, audit, and rules into separate services later
Storage	In-memory for POC, DB/Redis for production
Security	Basic auth/JWT for admin endpoint
Cloud Readiness	Full containerization, stateless, external configs
Data Source	Country rate map and EU country list (mocked for now)

11. üîí Security Practices
Role-based access control (admin vs compute)

Encrypted secrets and credentials

Validate input with ISO code regex

Enable HTTPS (in cloud environments)

Rate limiting and throttling via API Gateway (e.g., Kong, Istio)

12. üìé Appendices
A. Example EU ISO Mapping
json
Copy
Edit
{
  "AT": "EU", "BE": "EU", "DE": "EU", ..., "FR": "EU"
}
B. Sample Country Tax Rate Table
json
Copy
Edit
{
  "US": 0.0,
  "EU": 0.15,
  "AU": 0.15,
  "CA": 0.15,
  "DEFAULT": 0.30
}
C. Swagger/OpenAPI Sample Snippet
yaml
Copy
Edit
paths:
  /api/tax/compute:
    post:
      summary: Calculate tax withholding
      requestBody:
        ...
13. üì¢ Next Steps After POC
Refactor remaining ATX monolith components into services

Move to AWS/GCP/Azure (based on OrgA's strategy)

Enable versioned tax rule APIs for future legal changes

Integrate with enterprise data sources (legal entity, reference data)

Enhance with role-based UI and analytics dashboard

