#!/bin/bash

# Fetch the new Jenkins Docker image and agent from OpenShift
oc login <OpenShift_URL> -u <username> -p $OPENSHIFT_PASSWORD
oc project <project_name>
oc import-image jenkins:latest --from=<openshift_repo>/jenkins:latest --confirm
oc import-image jenkins-agent-python:latest --from=<openshift_repo>/jenkins-agent-python:latest --confirm
oc import-image jenkins-agent-java:latest --from=<openshift_repo>/jenkins-agent-java:latest --confirm

# Start a Jenkins pod using the new image
oc new-app jenkins:latest

# Validate that the Jenkins pod is running
if oc get pod | grep -q "jenkins.*Running"; then
    echo "Jenkins is running"
else
    echo "Error: Jenkins is not running"
    exit 1
fi

# Run a Python build using the new agent
oc new-build --name=python-build --image-stream=python:latest --binary
oc start-build python-build --from-dir=. --follow

# Run a Java build using the new agent
oc new-build --name=java-build --image-stream=java:latest --binary
oc start-build java-build --from-dir=. --follow

export OPENSHIFT_PASSWORD=your_password
