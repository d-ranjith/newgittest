const readline = require('readline');
const fs = require('fs');
const path = require('path');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

// Prompt the user for the manifest type name
rl.question('Provide your custom manifest type name: ', (manifestTypeName) => {
  // Construct the path to the JSON file based on the manifest type name
  const sourceFilePath = path.join('config', `${manifestTypeName}.json`);
  const destinationFilePath = `${manifestTypeName}_cloned.json`;

  try {
    let jsonData;

    // Check if the source file exists
    if (fs.existsSync(sourceFilePath)) {
      // If the source file exists, read it
      const data = fs.readFileSync(sourceFilePath, 'utf8');
      jsonData = JSON.parse(data);

      // Clone the original data
      const clonedData = { ...jsonData };

      // Prompt the user for additional values
      rl.question('Provide the description for the manifest type: ', (description) => {
        rl.question('Provide the README.md URL to the Bitbucket repository: ', (documentation) => {
          rl.question('Provide tags (comma-separated): ', (tags) => {
            rl.question('Provide createdBy (user name or DL alias): ', (createdBy) => {
              rl.question('Provide the initial version: ', (latestVersion) => {
                // Close the readline interface
                rl.close();

                // Update the cloned data with user input
                clonedData.name = manifestTypeName;
                clonedData.latestVersion = latestVersion;
                clonedData.description = description;
                clonedData.documentation = documentation;
                clonedData.tags = tags.split(',').map((tag) => tag.trim());
                clonedData.versions[0].version = latestVersion;
                clonedData.versions[0].createdBy = createdBy;
                clonedData.versions[0].createdTime = new Date().toISOString();
                clonedData.versions[0].lastModifiedTime = new Date().toISOString();

                // Write the cloned data to a new file
                fs.writeFileSync(destinationFilePath, JSON.stringify(clonedData, null, 2));

                console.log('File updated successfully.');
                console.log('Cloned file location:', destinationFilePath);
              });
            });
          });
        });
      });
    } else {
      // If the source file does not exist, create a new file with prompts
      rl.question('Provide the description for the manifest type: ', (description) => {
        rl.question('Provide the README.md URL to the Bitbucket repository: ', (documentation) => {
          rl.question('Provide tags (comma-separated): ', (tags) => {
            rl.question('Provide createdBy (user name or DL alias): ', (createdBy) => {
              rl.question('Provide the initial version: ', (latestVersion) => {
                // Close the readline interface
                rl.close();

                // Create a new JSON object with user input
                jsonData = {
                  name: manifestTypeName,
                  latestVersion: latestVersion,
                  description: description,
                  documentation: documentation,
                  tags: tags.split(',').map((tag) => tag.trim()),
                  enabled: true,
                  versions: [
                    {
                      version: latestVersion,
                      createdBy: createdBy,
                      createdTime: new Date().toISOString(),
                      lastModifiedTime: new Date().toISOString(),
                      branchName: 'master',
                      enabled: true
                    }
                  ]
                };

                // Write the new JSON data to a new file
                fs.writeFileSync(destinationFilePath, JSON.stringify(jsonData, null, 2));

                console.log('New file created successfully.');
                console.log('Cloned file location:', destinationFilePath);
              });
            });
          });
        });
      });
    }
  } catch (error) {
    console.error('Error:', error.message);
  }
});
