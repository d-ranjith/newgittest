# Use the Windows Server Core 2022 image with IIS installed
FROM mcr.microsoft.com/windows/servercore/iis:windowsservercore-ltsc2022

# Enable IIS features (if not already enabled, typically these are enabled in IIS images)
RUN powershell -Command \
    Add-WindowsFeature Web-Server; \
    Add-WindowsFeature NET-Framework-45-ASPNET; \
    Add-WindowsFeature Web-Asp-Net45

# Create a new directory for the website files
RUN mkdir C:\inetpub\wwwroot\myapp

# Copy the website files from the host to the container
COPY ./myapp/ C:\inetpub\wwwroot\myapp

# Configure IIS to point to the new directory
RUN powershell -Command \
    Import-Module IISAdministration; \
    $sm = Get-IISServerManager; \
    $sm.Sites['Default Web Site'].Applications['/'].VirtualDirectories['/'].PhysicalPath = 'C:\inetpub\wwwroot\myapp'; \
    $sm.CommitChanges()

# Set up environment variables, if necessary
# ENV example_key example_value

# Expose port 80 for HTTP access to the site
EXPOSE 80

# Start IIS service
ENTRYPOINT ["C:\\ServiceMonitor.exe", "w3svc"]
